name: Update python constraints
on:
  workflow_dispatch:
  schedule:
    - cron: "0 13 * * 1"
jobs:
  constraints:
    runs-on: ubuntu-latest
    # This must be the same image as the one the ODK is built on.
    container: ubuntu:24.04
    strategy:
      max-parallel: 1
    steps:
      - name: Install Required Packages
        run: |
          apt-get update
          apt-get install -y --no-install-recommends git ca-certificates
      - name: Checkout main branch
        uses: actions/checkout@v4
        with:
          persist-credentials: false  # Ensure credentials are stored properly
      - name: Build constraints.txt
        run: sh update-constraints.sh --in-docker
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        if: ${{ success() }}
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: Update constraints.txt
          title: 'Update constraints.txt'
          body: |
            This pull request updates constraints.txt. Make sure you run make tests manually.
          assignees: matentzn
